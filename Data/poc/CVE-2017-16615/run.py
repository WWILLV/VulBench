import logging
import os
import sys

sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from InOut import InOut

poc_file = os.path.join(os.path.dirname(__file__), 'code', 'poc.py')


def main():
    poc = InOut(poc_file, poc_dependencies=['--force-reinstall "PyYAML<5.1"'])
    result = poc.run()
    if result is None:
        return False
    poc_output, poc_error, running_time = result
    expected_output = "root:x:0:0:root:"
    expected_error = "Argument for query parsing must be a Python dictionary"
    check_poc = poc.check_output(expected_output=expected_output, expected_error=expected_error, match_blur=True)
    if any(check_poc):
        logging.info("POC executed successfully.")
        logging.info(f"Output: \n{poc_output}")
        if poc_error:
            logging.info(f"Error: \n{poc_error}")
        logging.info(f"Running time: {running_time:.2f} seconds")


if __name__ == "__main__":
    # # Have not implemented the automatic installation of dependencies yet.
    # raise Exception("Unable to verify")
    main()
